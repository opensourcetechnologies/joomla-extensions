<?php   	 /** * @package     Joomla.Site * @subpackage  mod_jreviews_map * * @copyright   Copyright (C) 2009 - 2016 Open Source Technologies, Inc. All rights reserved. * @license     GNU General Public License version 2 or later; see LICENSE.txt */ 	// no direct access		defined('_JEXEC') or die;	$latitude = ""; $longitude = ""; $message = "";    $urlData = array();    $router = JSite::getRouter();    $var = $router->getVars();    $urlData = $router->getVars();   	if(isset($urlData['option']) && $urlData['option'] == "com_content" && isset($urlData['view']) && $urlData['view'] == "article")	{		$lati = trim($params->get('latitude_field'));		$long = trim($params->get('longitude_field'));		$latitude = "";		$articleid = (isset($urlData['id'])) ? $urlData['id'] : "";		$db = JFactory::getDBO();		if($articleid):					$temp = explode(':',$articleid);			$articleid = $temp[0];					$query = 'select '.$lati.','.$long.', title from #__jreviews_content jc , #__content ac where ac.id=jc.contentid AND jc.contentid = '.$articleid;			$db->setQuery($query);			$position = array();			$position = $db->loadAssoc();			if(isset($position) && count($position) > 0)			{				$latitude = $position[$lati];				$longitude = $position[$long];				$message = $position['title'];			}				endif;	}	if($latitude == "")	{		$latitude = $params->get('latitude');		$longitude = $params->get('longitude');		$message = $params->get('messag');	}?><script src="http://maps.google.com/maps?file=api&amp;v=2.x<?php if( $params->get('google_map_key') != "" ) {  echo  '&amp;key=' . $params->get('google_map_key');} ?>" type="text/javascript"></script><script type="text/javascript">     var map;    var marker = null;			function initialize() 	{		if (GBrowserIsCompatible()) 		{			map = new GMap2(document.getElementById("map_canvas"));			map.setCenter(new GLatLng(<?php echo $latitude; ?>, <?php echo $longitude; ?>),			<?php echo $params->get('zoom'); ?>);			map.setMapType(G_NORMAL_MAP);			marker = new GMarker(new GLatLng(<?php echo $params->get('marker_lat'); ?>, <?php echo $params->get('marker_lon'); ?>));			GEvent.addListener(marker,  "mouseover",  addMessag);			map.addOverlay( marker );			var mapTypeControl = new GMapTypeControl();			var topRight = new GControlPosition(G_ANCHOR_TOP_RIGHT, new GSize(5,5));			if( (<?php echo $params->get('menu_map'); ?>) !=0) 			{			   map.addControl(mapTypeControl, topRight); 			}			if( (<?php echo $params->get('control_map'); ?>) !=0 ) 			{					map.addControl(new GSmallMapControl());			}		}	}		  	function addMessag() 	{		marker.openInfoWindowHtml("<?php echo $params->get('messag'); ?>");	}</script> <iframe src="modules/mod_jreviews_map/razn_google_map.php?google_map_key=<?php echo $params->get('google_map_key')?>&	latitude=<?php echo $latitude?>&	longitude=<?php echo $longitude?>&	zoom=<?php echo $params->get('zoom')?>&	marker_lat=<?php echo $latitude?>&	marker_lon=<?php echo $longitude?>&	menu_map=<?php echo $params->get('menu_map')?>&	control_map=<?php echo $params->get('control_map')?>&	messag=<?php echo $message?>&	map_height=<?php echo $params->get('map_height')?>"	scrolling="no" style="width: <?php echo $params->get('map_width')?>%; height: <?php echo $params->get('map_height')?>px;" border="0px" marginwidth="0px" marginheight="0px"></iframe>